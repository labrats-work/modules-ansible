---
# tasks file for calico_init

- name: Create tigera operator.
  become: no
  ansible.builtin.command: kubectl create -f https://raw.githubusercontent.com/projectcalico/calico/v3.24.0/manifests/tigera-operator.yaml

- name: Create yaml configs.
  become: no
  ansible.builtin.blockinfile:
    path: calico_init.yaml
    marker: "# {mark} ANSIBLE MANAGED BLOCK {{ item.name }}"
    block: |
      ---
      {{ item | to_nice_yaml(sort_keys=false) }}
  loop: "{{ yaml_configs }}"

- name: Run calico init.
  become: no
  ansible.builtin.command: kubectl apply -f calico_init.yaml